#!/bin/bash

path="$1"

if [ -z "$path" ]; then
	if [ -z "$WAPPALYZER_ROOT" ]; then
		echo "-$(basename $0): No path specified"

		exit 1
	fi

	path="$WAPPALYZER_ROOT"
fi

set -eu

if [ ! -d "$path/src" ]; then
	echo "-$(basename $0): Incorrect path"

	exit 1
fi

path="$path/src"

echo "Validating apps.json..."

node "$WAPPALYZER_NODE_PATH/node_modules/jsonlint/lib/cli.js" --quiet -V "$WAPPALYZER_ROOT/schema.json" "$path/apps.json"

echo "Validating regular expressions..."

wappalyzer validate-regex

echo "Validating icons..."

wappalyzer validate-icons
